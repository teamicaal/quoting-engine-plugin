!function($){var i=[],a=function(){return i.length?i[i.length-1]:null},o=function(){var a,o=!1;for(a=i.length-1;a>=0;a--)i[a].$blocker&&(i[a].$blocker.toggleClass("current",!o).toggleClass("behind",o),o=!0)};$.icaal__modal=function(o,l){var t,e;if(this.$body=$("body"),this.options=$.extend({},$.icaal__modal.defaults,l),this.options.doFade=!isNaN(parseInt(this.options.fadeDuration,10)),this.$blocker=null,this.options.closeExisting)for(;$.icaal__modal.isActive();)$.icaal__modal.close();if(i.push(this),o.is("a"))if(e=o.attr("href"),/^#/.test(e)){if(this.$elm=$(e),1!==this.$elm.length)return null;this.$body.append(this.$elm),this.open()}else this.$elm=$("<div>"),this.$body.append(this.$elm),t=function(i,a){a.elm.remove()},this.showSpinner(),o.trigger($.icaal__modal.AJAX_SEND),$.get(e).done(function(i){if($.icaal__modal.isActive()){o.trigger($.icaal__modal.AJAX_SUCCESS);var l=a();l.$elm.empty().append(i).on($.icaal__modal.CLOSE,t),l.hideSpinner(),l.open(),o.trigger($.icaal__modal.AJAX_COMPLETE)}}).fail(function(){o.trigger($.icaal__modal.AJAX_FAIL);var l=a();l.hideSpinner(),i.pop(),o.trigger($.icaal__modal.AJAX_COMPLETE)});else this.$elm=o,this.$body.append(this.$elm),this.open()},$.icaal__modal.prototype={constructor:$.icaal__modal,open:function(){var i=this;this.block(),this.options.doFade?setTimeout(function(){i.show()},this.options.fadeDuration*this.options.fadeDelay):this.show(),$(document).off("keydown.icaal__modal").on("keydown.icaal__modal",function(i){var o=a();27==i.which&&o.options.escapeClose&&o.close()}),this.options.clickClose&&this.$blocker.click(function(i){i.target==this&&$.icaal__modal.close()})},close:function(){i.pop(),this.unblock(),this.hide(),$.icaal__modal.isActive()||$(document).off("keydown.icaal__modal")},block:function(){this.$elm.trigger($.icaal__modal.BEFORE_BLOCK,[this._ctx()]),this.$body.css("overflow","hidden"),this.$blocker=$('<div class="jquery-icaal__modal blocker current"></div>').appendTo(this.$body),o(),this.options.doFade&&this.$blocker.css("opacity",0).animate({opacity:1},this.options.fadeDuration),this.$elm.trigger($.icaal__modal.BLOCK,[this._ctx()])},unblock:function(i){!i&&this.options.doFade?this.$blocker.fadeOut(this.options.fadeDuration,this.unblock.bind(this,!0)):(this.$blocker.children().appendTo(this.$body),this.$blocker.remove(),this.$blocker=null,o(),$.icaal__modal.isActive()||this.$body.css("overflow",""))},show:function(){this.$elm.trigger($.icaal__modal.BEFORE_OPEN,[this._ctx()]),this.options.showClose&&(this.closeButton=$('<a href="#close-icaal__modal" rel="icaal__modal:close" class="close-icaal__modal '+this.options.closeClass+'">'+this.options.closeText+"</a>"),this.$elm.append(this.closeButton)),this.$elm.addClass(this.options.icaal__modalClass).appendTo(this.$blocker),this.options.doFade?this.$elm.css("opacity",0).show().animate({opacity:1},this.options.fadeDuration):this.$elm.show(),this.$elm.trigger($.icaal__modal.OPEN,[this._ctx()])},hide:function(){this.$elm.trigger($.icaal__modal.BEFORE_CLOSE,[this._ctx()]),this.closeButton&&this.closeButton.remove();var i=this;this.options.doFade?this.$elm.fadeOut(this.options.fadeDuration,function(){i.$elm.trigger($.icaal__modal.AFTER_CLOSE,[i._ctx()])}):this.$elm.hide(0,function(){i.$elm.trigger($.icaal__modal.AFTER_CLOSE,[i._ctx()])}),this.$elm.trigger($.icaal__modal.CLOSE,[this._ctx()])},showSpinner:function(){this.options.showSpinner&&(this.spinner=this.spinner||$('<div class="'+this.options.icaal__modalClass+'-spinner"></div>').append(this.options.spinnerHtml),this.$body.append(this.spinner),this.spinner.show())},hideSpinner:function(){this.spinner&&this.spinner.remove()},_ctx:function(){return{elm:this.$elm,$blocker:this.$blocker,options:this.options}}},$.icaal__modal.close=function(i){if($.icaal__modal.isActive()){i&&i.preventDefault();var o=a();return o.close(),o.$elm}},$.icaal__modal.isActive=function(){return i.length>0},$.icaal__modal.defaults={closeExisting:!0,escapeClose:!0,clickClose:!0,closeText:"Close",closeClass:"",icaal__modalClass:"icaal__modal",spinnerHtml:null,showSpinner:!0,showClose:!0,fadeDuration:null,fadeDelay:1},$.icaal__modal.BEFORE_BLOCK="icaal__modal:before-block",$.icaal__modal.BLOCK="icaal__modal:block",$.icaal__modal.BEFORE_OPEN="icaal__modal:before-open",$.icaal__modal.OPEN="icaal__modal:open",$.icaal__modal.BEFORE_CLOSE="icaal__modal:before-close",$.icaal__modal.CLOSE="icaal__modal:close",$.icaal__modal.AFTER_CLOSE="icaal__modal:after-close",$.icaal__modal.AJAX_SEND="icaal__modal:ajax:send",$.icaal__modal.AJAX_SUCCESS="icaal__modal:ajax:success",$.icaal__modal.AJAX_FAIL="icaal__modal:ajax:fail",$.icaal__modal.AJAX_COMPLETE="icaal__modal:ajax:complete",$.fn.icaal__modal=function(i){return 1===this.length&&new $.icaal__modal(this,i),this},$(document).on("click.icaal__modal",'a[rel="icaal__modal:close"]',$.icaal__modal.close),$(document).on("click.icaal__modal",'a[rel="icaal__modal:open"]',function(i){i.preventDefault(),$(this).icaal__modal()})}(jQuery),$(function(){$('[data-toggle="quoting-engine"]').icaal__modal()});